#!/bin/sh

[ "$(pgrep -x $(basename $0))" != "$$" ] && exit 1

caps2esc

while [ true ]
do
    window=`xdotool getwindowfocus getwindowname`
    is_enabled=`xinput --list-props bcm5974 | awk '/Device Enabled/{print $NF}'`
    if [ "$window" = "Terminal" ]; then
        if [ "$is_enabled" = "1" ]; then
            xinput disable bcm5974
            caps2esc
        fi
    else
        if [ "$is_enabled" = "0" ]; then
            xinput enable bcm5974
        fi
    fi
    sleep 1
done
